<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dissecting Crates.io: Bare Minimum Mirror - gmjosack</title>

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,700">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="/static/css/gmjosack.css">
  <link rel="stylesheet" href="/static/css/syntax.css">
  

</head>
<body>
  <div class="container">

    <!-- NavBar -->
    <header>
      <div class="menu show-menu">
        <ul class="nav">
          <li class="page ">
            <a title="Home" href="/">Home</a>
          </li>
          <li class="page ">
            <a title="Posts" href="/posts/">Posts</a>
          </li>
          <li class="page ">
            <a title="Resume" href="/resume/">Resume</a>
          </li>
          <li>
            <div class="vertical-divider"></div>
          </li>
          <li class="ext-badge">
            <a title="Github" href="https://github.com/gmjosack">
              <i class="fa fa-fw fa-lg fa-github"></i>
            </a>
          </li>
          <li class="ext-badge">
            <a title="Hacker News" href="https://news.ycombinator.com/user?id=gmjosack">
              <i class="fa fa-fw fa-lg fa-hacker-news"></i>
            </a>
          </li>
          <li class="ext-badge">
            <a title="Reddit" href="https://www.reddit.com/user/gmjosack">
              <i class="fa fa-fw fa-lg fa-reddit"></i>
            </a>
          </li>
          <li class="ext-badge">
            <a title="Twitter" href="https://twitter.com/gmjosack">
              <i class="fa fa-fw fa-lg fa-twitter"></i>
            </a>
          </li>
          <li class="ext-badge">
            <a title="LinkedIn" href="https://www.linkedin.com/in/gmjosack">
              <i class="fa fa-fw fa-lg fa-linkedin"></i>
            </a>
          </li>
        </ul>
      </div>
    </header>

    <hr class="header-separator">

    <!-- Main Content -->
    <div class="content-row row">
      <div class="content col-md-10 col-md-offset-1">
        
<h6>Saturday, August 8, 2015</h6>
<h1>Dissecting Crates.io: Bare Minimum Mirror</h1>

<p>Coming up soon at <code>$job</code> we're going to start deploying some Rust code to production. One of the really nice things about developing Rust code is the included package manager, <code>cargo</code>, and all of the crates available at <a href="https://crates.io/">crates.io</a>. One especially nice feature of crates.io, compared to other package repositories I have experience with, is the fact that they will never allow a user to overwrite or delete a version of published code<sup>[1]</sup>. They do support an action called <code>yank</code><sup>[2]</sup> which allows you do prevent new projects from depending on a version but it will still be available to projects that have a Cargo.lock. This is great because I have much less to worry about in regard to repeatable builds when using cargo with crates.io.</p>
<p>Unfortunately we're not going to want to rely on crates.io being up to push code to production. While crates.io has been mostly stable I can't rely on that stability when I need to push an emergency bug fix. Also, I might have development and/or build servers that don't have access to the internet to begin with. With other languages I'd just throw up a caching mirror and point my package manager at that. Rust, however, is still pretty young and I wasn't able to find anything in regard to mirroring crates.io other than a single issue<sup>[3]</sup> on GitHub. With that I set out to learn more about how cargo and crates.io interact and what it would take to setup a bare minimum mirror.</p>
<h2>Index</h2>
<p>The first thing I need to do is figure out how to point cargo at my "mirror" but I don't even know what protocol cargo speaks. In the issue I mentioned above it was stated that you'd need to clone the official index<sup>[4]</sup> to create a mirror. Hmm, this is just a repo on GitHub but doesn't contain the actual packages.</p>
<div class="highlight"><pre>
</pre></div>
<h2>Resources</h2>
<ol>
<li><a href="http://doc.crates.io/crates-io.html#publishing-crates">http://doc.crates.io/crates-io.html#publishing-crates</a></li>
<li><a href="http://doc.crates.io/crates-io.html#cargo-yank">http://doc.crates.io/crates-io.html#cargo-yank</a></li>
<li><a href="https://github.com/rust-lang/crates.io/issues/67">https://github.com/rust-lang/crates.io/issues/67</a></li>
<li><a href="https://github.com/rust-lang/crates.io-index">https://github.com/rust-lang/crates.io-index</a></li>
</ol>
<ul>
<li><a href="https://github.com/rust-lang/cargo">https://github.com/rust-lang/cargo</a></li>
<li><a href="https://github.com/rust-lang/crates.io">https://github.com/rust-lang/crates.io</a></li>
<li><a href="https://github.com/rust-lang/cargo/blob/master/src/cargo/sources/registry.rs">https://github.com/rust-lang/cargo/blob/master/src/cargo/sources/registry.rs</a></li>
</ul>


      </div>
      <div class="col-md-1">
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
  

</body>
</html>
